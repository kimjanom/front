!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).SvgBoard=t()}(this,function(){"use strict";var b="http://www.w3.org/2000/svg";class d{constructor(e){const o=this;o.state=0,o.main=e.main,o.object=e.object,o.allowClick=e.allowClick??!0,o.allowDrag=e.allowDrag??!0,o.multipleX=e.multipleX??1,o.multipleY=e.multipleY??1,o.focusMaintain=e.focusMaintain??!1,o.allowMoveX=e.allowMoveX??!0,o.allowMoveY=e.allowMoveY??!0,o.customMoveAt=e.customMoveAt,o.clickCallbacks=[],o.dragStartCallbacks=[],o.draggingCallbacks=[],o.dragEndCallbacks=[],o.onMouseDown=function(e){if(0===e.button&&!0===o.allowClick&&0===o.state&&!e.currentTarget.classList.contains("event-exclude")){e.stopPropagation(),void 0!==o.main.data.focusObject?!1===o.focusMaintain&&o.main.data.focusObject!==o.object&&(o.main.data.focusObject.data.focus=!1,o.object.data.focus=!0,o.main.data.focusObject=o.object):(o.object.data.focus=!0,o.main.data.focusObject=o.object);let i=0,r=0;o.state=1,i=Math.floor(+e.pageX)-o.object.data.x*o.multipleX,r=Math.floor(+e.pageY)-o.object.data.y*o.multipleY;for(const t of o.dragStartCallbacks)t(e);function s(e){if(!0===o.allowDrag&&1===o.state){e.stopPropagation(),function(t,n){if(void 0===o.customMoveAt)!0===o.allowMoveX&&(o.object.data.x=Math.round(t)*o.multipleX),!0===o.allowMoveY&&(o.object.data.y=Math.round(n)*o.multipleY);else{let e=t;n=n;!0===o.allowMoveX&&(e=Math.round(t)*o.multipleX),!0===o.allowMoveY&&(e=Math.round(t)*o.multipleX),o.customMoveAt({x:e,y:n})}}(Math.floor(+e.pageX)-i,Math.floor(+e.pageY)-r);for(const t of o.draggingCallbacks)t(e)}}window.addEventListener("mousemove",s),window.addEventListener("mouseup",function e(t){if(1===o.state){t.stopPropagation(),o.state=0,s(t),Math.floor(+t.pageX),i,Math.floor(+t.pageY),r,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e);for(const n of o.dragEndCallbacks)n(t);for(const a of o.clickCallbacks)a(t)}}),s(e)}},o.object.element.addEventListener("mousedown",o.onMouseDown)}addClickEventListener(e){this.clickCallbacks.push(e)}addDragStartEventListener(e){this.dragStartCallbacks.push(e)}addDraggingEventListener(e){this.draggingCallbacks.push(e)}addDragEndEventListener(e){this.dragEndCallbacks.push(e)}destroy(){this.object.element.removeEventListener("mousedown",this.onMouseDown)}}const r={generateUUID:function(){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;const n="x"===e?t:3&t|8;return n.toString(16)});return e.substring(0,8)}};class e{constructor(e){this.main=e.main,this.type=e.type,this.id=e.id,this.name=e.name??this.id,this.layerIndex=e.layerIndex,this.focus=!1,this.metaData=e.metaData}destroy(){throw new Error(this.type+"의 Fdestroy 함수를 정의해야 합니다.")}toJson(){throw new Error(this.type+"의 toJson 함수를 정의해야 합니다.")}}class c extends e{constructor(e){super({main:e.main,type:"Joint",id:e.id??r.generateUUID(),name:e.name,metaData:e.metaData});const o=this;o.element=document.createElementNS(b,"circle"),o.element.classList.add("sb-joint"),o.draggable=new d({main:o.main,object:o}),o.parentId=e.parentId,o.x=0,o.y=0,o.r=0,o.enable=!0,o.changeCallbacks=[],o.data=new Proxy(o,{set(e,t,n,a){switch(e[t]=n,t){case"focus":return!0===n?o.element.classList.add("sb-focus"):o.element.classList.remove("sb-focus"),!0;case"x":o.element.setAttributeNS(null,"cx",n);for(var i of o.changeCallbacks)i();return!0;case"y":o.element.setAttributeNS(null,"cy",n);for(var r of o.changeCallbacks)r();return!0;case"r":o.element.setAttributeNS(null,"r",n);for(var s of o.changeCallbacks)s();return!0}return!0}}),o.data.x=e.x??0,o.data.y=e.y??0,o.data.r=e.r??5}getData(){return this.data}addDragStartEventListener(e){this.draggable.addDragStartEventListener(e)}addDraggingEventListener(e){this.draggable.addDraggingEventListener(e)}addDragEndEventListener(e){this.draggable.addDragEndEventListener(e)}addChangeEventListener(e){this.changeCallbacks.push(e)}destroy(){this.draggable.destroy(),void 0!==this.element.parentNode&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.main.data.focusObject===this&&(this.main.data.focusObject=void 0)}toJson(){return{type:this.type,id:this.id,name:this.name,x:this.data.x,y:this.data.y,r:this.data.r,metaData:this.metaData}}}class i extends e{constructor(e){super({main:e.main,type:"Link",id:e.id??r.generateUUID(),name:e.name,metaData:e.metaData});const i=this;i.joint1=e.joint1,i.joint2=e.joint2,i.element=document.createElementNS(b,"line"),i.element.classList.add("sb-link"),i.backgroundElement=document.createElementNS(b,"line"),i.backgroundElement.classList.add("sb-link-background"),i.parentId=e.parentId,i.x1=0,i.y1=0,i.x2=0,i.y2=0,i.data=new Proxy(i,{set(e,t,n,a){switch(t){case"focus":return!0===n?i.element.classList.add("sb-focus"):i.element.classList.remove("sb-focus"),!0;case"x1":return i.element.setAttributeNS(null,"x1",n),i.backgroundElement.setAttributeNS(null,"x1",n),!0;case"y1":return i.element.setAttributeNS(null,"y1",n),i.backgroundElement.setAttributeNS(null,"y1",n),!0;case"x2":return i.element.setAttributeNS(null,"x2",n),i.backgroundElement.setAttributeNS(null,"x2",n),!0;case"y2":return i.element.setAttributeNS(null,"y2",n),i.backgroundElement.setAttributeNS(null,"y2",n),!0}return!0}}),i.data.x1=i.joint1.data.x,i.data.y1=i.joint1.data.y,i.data.x2=i.joint2.data.x,i.data.y2=i.joint2.data.y,i.joint1.addDragStartEventListener(function(e){i.data.x1=i.joint1.data.x,i.data.y1=i.joint1.data.y}),i.joint1.addDraggingEventListener(function(e){i.data.x1=i.joint1.data.x,i.data.y1=i.joint1.data.y}),i.joint1.addDragEndEventListener(function(e){i.data.x1=i.joint1.data.x,i.data.y1=i.joint1.data.y}),i.joint1.addChangeEventListener(function(e){i.data.x1=i.joint1.data.x,i.data.y1=i.joint1.data.y}),i.joint2.addDragStartEventListener(function(e){i.data.x2=i.joint2.data.x,i.data.y2=i.joint2.data.y}),i.joint2.addDraggingEventListener(function(e){i.data.x2=i.joint2.data.x,i.data.y2=i.joint2.data.y}),i.joint2.addDragEndEventListener(function(e){i.data.x2=i.joint2.data.x,i.data.y2=i.joint2.data.y}),i.joint2.addChangeEventListener(function(e){i.data.x2=i.joint2.data.x,i.data.y2=i.joint2.data.y})}getData(){return this.data}destroy(){void 0!==this.element.parentNode&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element),void 0!==this.backgroundElement.parentNode&&null!==this.backgroundElement.parentNode&&this.backgroundElement.parentNode.removeChild(this.backgroundElement)}}const f={getXy(t){switch(t.tagName){case"g":{let e=t.getAttributeNS(null,"transform");return void 0!==e&&null!==e?(e=e.replace(/[^0-9-.,]/g,""),e=e.split(",",-1),{x:Number(e[0]),y:Number(e[1])}):{x:0,y:0}}case"circle":var e=t.getAttributeNS(null,"cx"),n=t.getAttributeNS(null,"cy");return{x:Number(e),y:Number(n)};default:if(t.hasAttribute("x")&&t.hasAttribute("y")){e=t.getAttributeNS(null,"x"),n=t.getAttributeNS(null,"y");return{x:Number(e),y:Number(n)}}{const a=t.closest("g");if(void 0===a||null===a)return{x:void 0,y:void 0};{let e=a.getAttributeNS(null,"transform");return e=e.replace(/[^0-9-.,]/g,""),e=e.split(",",-1),{x:Number(e[0]),y:Number(e[1])}}}}},setXy(e,t,n){switch(e.tagName){case"g":e.setAttributeNS(null,"transform",`translate(${t},${n})`),e.setAttributeNS(null,"x",t),e.setAttributeNS(null,"y",n);break;case"circle":e.setAttributeNS(null,"cx",t),e.setAttributeNS(null,"cy",n),e.setAttributeNS(null,"x",t),e.setAttributeNS(null,"y",n);break;default:e.setAttributeNS(null,"x",t),e.setAttributeNS(null,"y",n)}}},m={maxByArray(e){return Math.max.apply(null,e)},minByArray(e){return Math.min.apply(null,e)}},o={SkeletonJoint00:"코",SkeletonJoint01:"목",SkeletonJoint02:"왼쪽 어깨",SkeletonJoint03:"오른쪽 어깨",SkeletonJoint04:"왼쪽 팔꿈치",SkeletonJoint05:"오른쪽 팔꿈치",SkeletonJoint06:"왼쪽 손목",SkeletonJoint07:"오른쪽 손목",SkeletonJoint08:"꼬리뼈",SkeletonJoint09:"왼쪽 골반",SkeletonJoint10:"오른쪽 골반",SkeletonJoint11:"왼쪽 무릎",SkeletonJoint12:"오른쪽 무릎",SkeletonJoint13:"왼쪽 발목",SkeletonJoint14:"오른쪽 발목"};class u extends e{constructor(e){super({main:e.main,type:"Skeleton",id:e.id??r.generateUUID(),name:e.name,layerIndex:e.layerIndex,metaData:e.metaData});const s=this;if(s.element=document.createElementNS(b,"g"),s.element.classList.add("sb-skeleton"),s.innerElement=document.createElementNS(b,"g"),s.innerElement.classList.add("sb-skeleton-inner"),s.element.append(s.innerElement),s.backgroundElement=document.createElementNS(b,"g"),s.backgroundElement.classList.add("sb-skeleton-background"),s.backgroundElement.classList.add("sb-event-ignore"),s.backgroundElement.classList.add("event-exclude"),s.backgroundRect1Element=document.createElementNS(b,"rect"),s.backgroundRect1Element.classList.add("sb-skeleton-background-rect1"),s.backgroundElement.append(s.backgroundRect1Element),s.backgroundRect2Element=document.createElementNS(b,"rect"),s.backgroundRect2Element.classList.add("sb-skeleton-background-rect2"),s.backgroundElement.append(s.backgroundRect2Element),s.linksElement=document.createElementNS(b,"g"),s.innerElement.append(s.linksElement),s.jointsElement=document.createElementNS(b,"g"),s.innerElement.append(s.jointsElement),s.centerElement=document.createElementNS(b,"g"),s.centerElement.classList.add("sb-skeleton-background-center"),s.centerElement.setAttributeNS(null,"transform","translate(0,0)"),s.innerElement.append(s.centerElement),s.centerPathElement=document.createElementNS(b,"path"),s.centerPathElement.classList.add("sb-skeleton-background-center-mark"),s.centerPathElement.setAttributeNS(null,"d","M -2,-2 L 2,2 M 2,-2 L -2,2"),s.centerPathElement.setAttributeNS(null,"x",0),s.centerPathElement.setAttributeNS(null,"y",0),s.centerElement.append(s.centerPathElement),s.colorSetId=void 0,s.beforeColorSetId=void 0,s.joints=[],s.links=[],s.draggable=new d({main:s.main,object:s}),s.isShow=!0,s.beforeIsShow=!0,s.x=0,s.y=0,s.width=0,s.height=0,s.data=new Proxy(s,{set(e,t,n,a){switch(e[t]=n,t){case"focus":return!0===n?(s.element.classList.add("sb-focus"),s.backgroundElement.classList.add("sb-focus")):(s.element.classList.remove("sb-focus"),s.backgroundElement.classList.remove("sb-focus")),!0;case"isShow":return!0===s.isShow&&!1===s.beforeIsShow?(s.element.append(s.innerElement),s.beforeIsShow=!0):!1===s.isShow&&!0===s.beforeIsShow&&(s.element.removeChild(s.innerElement),s.beforeIsShow=!1),!0;case"x":var i=f.getXy(s.element)["y"];return s.element.setAttributeNS(null,"transform",`translate(${n},${i})`),s.element.setAttributeNS(null,"x",n),s.element.setAttributeNS(null,"y",i),s.syncSize(),!0;case"y":var i=f.getXy(s.element)["x"];return s.element.setAttributeNS(null,"transform",`translate(${i},${n})`),s.element.setAttributeNS(null,"x",i),s.element.setAttributeNS(null,"y",n),s.syncSize(),!0;case"width":return s.element.setAttributeNS(null,"width",n),!0;case"height":return s.element.setAttributeNS(null,"height",n),!0;case"colorSetId":if(s.colorSetId!==s.beforeColorSetId){s.beforeColorSetId=s.colorSetId;for(const r of Object.values(s.element.classList))-1!==r.indexOf("sb-skeleton-color-")&&s.element.classList.remove(r);s.element.classList.add("sb-skeleton-color-"+s.colorSetId)}return!0}return!0}}),void 0!==e.jointJsons&&null!==e.jointJsons&&0<e.jointJsons.length)for(const t of e.jointJsons)s.joints.push(new c({main:s.main,id:t.id,name:t.name,x:t.x,y:t.y,r:t.r,parentId:s.id}));else s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint00,x:0,y:0,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint01,x:0,y:30,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint02,x:-30,y:30,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint03,x:30,y:30,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint04,x:-30,y:60,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint05,x:30,y:60,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint06,x:-30,y:90,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint07,x:30,y:90,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint08,x:0,y:120,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint09,x:-30,y:120,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint10,x:30,y:120,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint11,x:-30,y:150,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint12,x:30,y:150,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint13,x:-30,y:180,parentId:s.id})),s.joints.push(new c({main:s.main,id:r.generateUUID(),name:o.SkeletonJoint14,x:30,y:180,parentId:s.id}));s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[0],joint2:s.joints[1],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[1],joint2:s.joints[2],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[1],joint2:s.joints[3],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[2],joint2:s.joints[4],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[3],joint2:s.joints[5],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[4],joint2:s.joints[6],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[5],joint2:s.joints[7],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[1],joint2:s.joints[8],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[8],joint2:s.joints[9],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[8],joint2:s.joints[10],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[9],joint2:s.joints[11],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[10],joint2:s.joints[12],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[11],joint2:s.joints[13],parentId:s.id})),s.links.push(new i({main:s.main,id:r.generateUUID(),joint1:s.joints[12],joint2:s.joints[14],parentId:s.id})),s.data.x=e.x??0,s.data.y=e.y??0;for(const n of s.links)s.linksElement.append(n.backgroundElement),s.linksElement.append(n.element);for(const a of s.joints)s.jointsElement.append(a.element),a.addDragStartEventListener(function(e){s.syncSize()}),a.addDraggingEventListener(function(e){s.syncSize()}),a.addDragEndEventListener(function(e){s.syncSize()});this.data.x=e.x??0,this.data.y=e.y??0,this.data.colorSetId=e.colorSetId,s.syncSize()}getData(){return this.data}addDragStartEventListener(e){this.draggable.addDragStartEventListener(e)}addDragEndEventListener(e){this.draggable.addDragEndEventListener(e)}show(){this.data.isShow=!0}hide(){this.data.isShow=!1}enableJointByIndex(e){if(e in this.joints){const t=this.joints[e];if(!1===t.enable){for(const n of this.links)n.joint1.id!==t.id&&n.joint2.id!==t.id||(this.jointsElement.contains(n.joint1.element)||this.jointsElement.contains(n.joint2.element))&&(this.linksElement.append(n.backgroundElement),this.linksElement.append(n.element));this.jointsElement.append(t.element),t.enable=!0}}}disableJointByIndex(e){if(e in this.joints){const t=this.joints[e];if(!0===t.enable){this.jointsElement.contains(t.element)&&this.jointsElement.removeChild(t.element);for(const n of this.links)n.joint1.id!==t.id&&n.joint2.id!==t.id||(this.linksElement.contains(n.backgroundElement)&&this.linksElement.removeChild(n.backgroundElement),this.linksElement.contains(n.element)&&this.linksElement.removeChild(n.element));t.enable=!1}}}fixCenter(){if(0!==this.joints.length){var e=this.joints[0],t=e.data.x,n=e.data.y;for(const a of this.joints)a.data.x=a.data.x-t,a.data.y=a.data.y-n;for(const i of this.links)i.data.x1=i.joint1.data.x,i.data.y1=i.joint1.data.y,i.data.x2=i.joint2.data.x,i.data.y2=i.joint2.data.y;this.data.x=this.data.x+t,this.data.y=this.data.y+n}}destroy(){for(const e of this.joints)e.destroy();for(const t of this.links)t.destroy();void 0!==this.element.parentNode&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element),void 0!==this.backgroundElement.parentNode&&null!==this.backgroundElement.parentNode&&this.backgroundElement.parentNode.removeChild(this.backgroundElement),this.main.data.focusObject===this&&(this.main.data.focusObject=void 0),delete this.main.features[this.id]}syncSize(){var e=this.joints.filter(e=>e.enable).map(e=>e.data.x),t=this.joints.filter(e=>e.enable).map(e=>e.data.y),n=m.minByArray(e),a=m.maxByArray(e),e=m.minByArray(t),t=m.maxByArray(t);this.data.width=a-n,this.data.height=t-e,f.setXy(this.backgroundElement,this.data.x+n,this.data.y+e),this.backgroundRect1Element.setAttributeNS(null,"width",this.data.width),this.backgroundRect1Element.setAttributeNS(null,"height",this.data.height),this.backgroundRect2Element.setAttributeNS(null,"width",this.data.width),this.backgroundRect2Element.setAttributeNS(null,"height",this.data.height)}toJson(){const e=[];for(const t of this.joints)e.push(t.toJson());return{type:this.type,layerIndex:this.layerIndex,id:this.id,name:this.name,x:this.data.x,y:this.data.y,colorSetId:this.colorSetId,jointJsons:e,metaData:this.metaData}}}class y{constructor(e){const i=this;i.main=e.main,i.type=e.type,i.allowMoveX=e.allowMoveX??!0,i.allowMoveY=e.allowMoveY??!0,i.element=document.createElementNS(b,"circle"),i.element.classList.add("sb-transform-resize","sb-transform-resize-"+i.type),i.dragStartCallbacks=[],i.draggingCallbacks=[],i.dragEndCallbacks=[],i.x=e.x??0,i.y=e.y??0,i.r=e.r??4,i.draggable=new d({main:i.main,object:i,focusMaintain:!0,allowMoveX:i.allowMoveX,allowMoveY:i.allowMoveY}),i.data=new Proxy(i,{set(e,t,n,a){switch(e[t]=n,t){case"x":return i.element.setAttributeNS(null,"cx",i.x),!0;case"y":return i.element.setAttributeNS(null,"cy",i.y),!0;case"r":return i.element.setAttributeNS(null,"r",n),!0}return!0}}),i.data.x=i.x,i.data.y=i.y,i.data.r=i.r,i.draggable.addDragStartEventListener(function(e){for(const t of i.dragStartCallbacks)t({x:i.data.x,y:i.data.y})}),i.draggable.addDraggingEventListener(function(e){for(const t of i.draggingCallbacks)t({x:i.data.x,y:i.data.y})}),i.draggable.addDragEndEventListener(function(e){for(const t of i.dragEndCallbacks)t({x:i.data.x,y:i.data.y})})}addDragStartEventListener(e){this.dragStartCallbacks.push(e)}addDraggingEventListener(e){this.draggingCallbacks.push(e)}addDragEndEventListener(e){this.dragEndCallbacks.push(e)}destroy(){void 0!==this.element.parentNode&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}const v={ne:"ne",n:"n",nw:"nw",e:"e",w:"w",se:"se",s:"s",sw:"sw"};class t{constructor(e){const r=this,a=10;r.main=e.main,r.object=e.object,r.element=document.createElementNS(b,"g"),r.element.classList.add("sb-transform"),r.rect1Element=document.createElementNS(b,"rect"),r.rect1Element.classList.add("sb-transform-rect1"),r.element.append(r.rect1Element),r.resizeStartCallbacks=[],r.resizeEndCallbacks=[];let i=void 0,s=void 0,o=void 0,d=void 0,l=void 0,c=void 0;function t(){i=r.data.x,l=r.data.width}function n(){o=r.data.y,c=r.data.height}function m(e,t){var n=l-a;s=e.data.x,s<=n?(r.data.x=i+t,r.data.width=l-t):(r.data.x=i+n,r.data.width=l-n),r.object.data.x=r.data.x,r.object.data.width=r.data.width}function u(e,t){var n=c-a;d=e.data.y,d<=n?(r.data.y=o+t,r.data.height=c-t):(r.data.y=o+n,r.data.height=c-n),r.object.data.y=r.data.y,r.object.data.height=r.data.height}function h(){var e=l-a;s<=e?(r.data.x=i+s,r.data.width=l-s):(r.data.x=i+e,r.data.width=l-e),r.object.data.x=r.data.x,r.object.data.width=r.data.width,i=void 0,s=void 0,l=void 0}function g(){var e=c-a;d<=e?(r.data.y=o+d,r.data.height=c-d):(r.data.y=o+e,r.data.height=c-e),r.object.data.y=r.data.y,r.object.data.height=r.data.height,o=void 0,d=void 0,c=void 0}function E(e){e.data.x>=a?r.data.width=e.data.x:r.data.width=a,r.object.data.width=r.data.width}function p(e){e.data.y>=a?r.data.height=e.data.y:r.data.height=a,r.object.data.height=r.data.height}r.rect2Element=document.createElementNS(b,"rect"),r.rect2Element.classList.add("sb-transform-rect2"),r.element.append(r.rect2Element),r.resizeNW=new y({main:r.main,type:v.nw}),r.element.append(r.resizeNW.element),r.resizeNW.addDragStartEventListener(function({}){t(),n();for(const e of r.resizeStartCallbacks)e()}),r.resizeNW.addDraggingEventListener(function({x:e,y:t}){m(r.resizeNW,e),u(r.resizeNW,t)}),r.resizeNW.addDragEndEventListener(function({}){h(),g();for(const e of r.resizeEndCallbacks)e()}),r.resizeN=new y({main:r.main,type:v.n,allowMoveX:!1}),r.element.append(r.resizeN.element),r.resizeN.addDragStartEventListener(function({}){n();for(const e of r.resizeStartCallbacks)e()}),r.resizeN.addDraggingEventListener(function({y:e}){u(r.resizeN,e)}),r.resizeN.addDragEndEventListener(function({}){g();for(const e of r.resizeEndCallbacks)e()}),r.resizeNE=new y({main:r.main,type:v.ne}),r.element.append(r.resizeNE.element),r.resizeNE.addDragStartEventListener(function({}){n();for(const e of r.resizeStartCallbacks)e()}),r.resizeNE.addDraggingEventListener(function({y:e}){E(r.resizeNE),u(r.resizeNE,e)}),r.resizeNE.addDragEndEventListener(function({}){g();for(const e of r.resizeEndCallbacks)e()}),r.resizeW=new y({main:r.main,type:v.w,allowMoveY:!1}),r.element.append(r.resizeW.element),r.resizeW.addDragStartEventListener(function({}){t();for(const e of r.resizeStartCallbacks)e()}),r.resizeW.addDraggingEventListener(function({x:e}){m(r.resizeW,e)}),r.resizeW.addDragEndEventListener(function({}){h();for(const e of r.resizeEndCallbacks)e()}),r.resizeE=new y({main:r.main,type:v.e,allowMoveY:!1}),r.element.append(r.resizeE.element),r.resizeE.addDragStartEventListener(function({}){for(const e of r.resizeStartCallbacks)e()}),r.resizeE.addDraggingEventListener(function({}){E(r.resizeE)}),r.resizeE.addDragEndEventListener(function({}){for(const e of r.resizeEndCallbacks)e()}),r.resizeSW=new y({main:r.main,type:v.sw}),r.element.append(r.resizeSW.element),r.resizeSW.addDragStartEventListener(function({}){t();for(const e of r.resizeStartCallbacks)e()}),r.resizeSW.addDraggingEventListener(function({x:e}){m(r.resizeSW,e),p(r.resizeSW)}),r.resizeSW.addDragEndEventListener(function({}){h();for(const e of r.resizeEndCallbacks)e()}),r.resizeS=new y({main:r.main,type:v.s,allowMoveX:!1}),r.element.append(r.resizeS.element),r.resizeS.addDragStartEventListener(function({}){for(const e of r.resizeStartCallbacks)e()}),r.resizeS.addDraggingEventListener(function({}){p(r.resizeS)}),r.resizeS.addDragEndEventListener(function({}){for(const e of r.resizeEndCallbacks)e()}),r.resizeSE=new y({main:r.main,type:v.se}),r.element.append(r.resizeSE.element),r.resizeSE.addDragStartEventListener(function({}){for(const e of r.resizeStartCallbacks)e()}),r.resizeSE.addDraggingEventListener(function({}){E(r.resizeSE),p(r.resizeSE)}),r.resizeSE.addDragEndEventListener(function({}){for(const e of r.resizeEndCallbacks)e()}),r.x=0,r.y=0,r.width=0,r.height=0,r.data=new Proxy(r,{set(e,t,n,a){switch(e[t]=n,t){case"x":var i=f.getXy(r.element)["y"];return r.element.setAttributeNS(null,"transform",`translate(${n},${i})`),r.element.setAttributeNS(null,"x",n),!0;case"y":var i=f.getXy(r.element)["x"];return r.element.setAttributeNS(null,"transform",`translate(${i},${n})`),r.element.setAttributeNS(null,"y",n),!0;case"width":return n<0&&(n=0),r.rect1Element.setAttributeNS(null,"width",n),r.rect2Element.setAttributeNS(null,"width",n),r.resizeNW.data.x=0,r.resizeN.data.x=n/2,r.resizeNE.data.x=n,r.resizeW.data.x=0,r.resizeE.data.x=n,r.resizeSW.data.x=0,r.resizeS.data.x=n/2,r.resizeSE.data.x=n,!0;case"height":return n<0&&(n=0),r.rect1Element.setAttributeNS(null,"height",n),r.rect2Element.setAttributeNS(null,"height",n),r.resizeNW.data.y=0,r.resizeN.data.y=0,r.resizeNE.data.y=0,r.resizeW.data.y=n/2,r.resizeE.data.y=n/2,r.resizeSW.data.y=n,r.resizeS.data.y=n,r.resizeSE.data.y=n,!0}return!0}}),r.data.x=r.x,r.data.y=r.y,r.data.width=r.width,r.data.height=r.height}show(){this.main.foregroundLayerElement.append(this.element)}hide(){this.main.foregroundLayerElement.removeChild(this.element)}addResizeStartEventListener(e){this.resizeStartCallbacks.push(e)}addResizeEndEventListener(e){this.resizeEndCallbacks.push(e)}destroy(){this.resizeNW.destroy(),this.resizeN.destroy(),this.resizeNE.destroy(),this.resizeW.destroy(),this.resizeE.destroy(),this.resizeSW.destroy(),this.resizeS.destroy(),this.resizeSE.destroy(),void 0!==this.rect2Element.parentNode&&null!==this.rect2Element.parentNode&&this.rect2Element.parentNode.removeChild(this.rect2Element),void 0!==this.rect1Element.parentNode&&null!==this.rect1Element.parentNode&&this.rect1Element.parentNode.removeChild(this.rect1Element),void 0!==this.element.parentNode&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}class h extends e{constructor(e){super({main:e.main,type:"Rect",id:e.id??r.generateUUID(),name:e.name,layerIndex:e.layerIndex,metaData:e.metaData});const l=this;l.element=document.createElementNS(b,"g"),l.element.classList.add("sb-rect"),l.element.setAttributeNS(null,"data-id",e.id),l.descriptionBackgroundElement=document.createElementNS(b,"rect"),l.descriptionBackgroundElement.classList.add("sb-rect-description-background"),l.element.append(l.descriptionBackgroundElement),l.descriptionTextElement=document.createElementNS(b,"text"),l.descriptionTextElement.classList.add("sb-rect-description-text"),l.descriptionTextElement.setAttributeNS(null,"x",5),l.descriptionTextElement.setAttributeNS(null,"y",-10),l.element.append(l.descriptionTextElement),l.innerElement=document.createElementNS(b,"g"),l.innerElement.classList.add("sb-rect-inner"),l.element.append(l.innerElement),l.rectElement=document.createElementNS(b,"rect"),l.rectElement.classList.add("sb-rect-rect"),l.innerElement.append(l.rectElement),l.colorSetId=void 0,l.beforeColorSetId=void 0,l.draggable=new d({main:l.main,object:l}),l.transformable=new t({main:l.main,object:l}),l.isShow=!0,l.beforeIsShow=!0,l.x=e.x??0,l.y=e.y??0,l.width=e.width??0,l.height=e.height??0,l.description=void 0,l.beforeDescription=void 0,l.data=new Proxy(l,{set(e,t,n,a){switch(e[t]=n,t){case"focus":return!0===n?(l.element.classList.add("sb-focus"),l.transformable.show()):(l.element.classList.remove("sb-focus"),l.transformable.hide()),!0;case"isShow":return!0===l.isShow&&!1===l.beforeIsShow?(l.element.append(l.innerElement),l.element.append(l.descriptionBackgroundElement),l.element.append(l.descriptionTextElement),l.beforeIsShow=!0):!1===l.isShow&&!0===l.beforeIsShow&&(l.element.removeChild(l.innerElement),l.element.removeChild(l.descriptionBackgroundElement),l.element.removeChild(l.descriptionTextElement),l.beforeIsShow=!1),!0;case"x":var i=f.getXy(l.element)["y"];return l.element.setAttributeNS(null,"transform",`translate(${n},${i})`),l.element.setAttributeNS(null,"x",n),l.transformable.data.x=n,!0;case"y":var r=f.getXy(l.element)["x"];return l.element.setAttributeNS(null,"transform",`translate(${r},${n})`),l.element.setAttributeNS(null,"y",n),l.transformable.data.y=n,!0;case"width":return n<0&&(n=0),l.element.setAttributeNS(null,"width",n),l.rectElement.setAttributeNS(null,"width",n),l.transformable.data.width=n,!0;case"height":return n<0&&(n=0),l.element.setAttributeNS(null,"height",n),l.rectElement.setAttributeNS(null,"height",n),l.transformable.data.height=n,!0;case"colorSetId":if(l.colorSetId!==l.beforeColorSetId){l.beforeColorSetId=l.colorSetId;for(const d of Object.values(l.element.classList))-1!==d.indexOf("sb-rect-color-")&&(l.element.classList.remove(d),l.element.classList.remove("sb-rect-color"));l.element.classList.add("sb-rect-color","sb-rect-color-"+l.colorSetId)}return!0;case"description":var s,o;return l.description!==l.beforeDescription&&(void 0!==l.description&&null!==l.description?(l.descriptionTextElement.textContent=l.description,l.descriptionTextElement.classList.add("active")):(l.descriptionTextElement.textContent="",l.descriptionTextElement.classList.remove("active")),{x:s,y:o,width:i,height:r}=l.descriptionTextElement.getBBox(),l.descriptionBackgroundElement.setAttributeNS(null,"x",s-5),l.descriptionBackgroundElement.setAttributeNS(null,"y",o),l.descriptionBackgroundElement.setAttributeNS(null,"width",i+10),l.descriptionBackgroundElement.setAttributeNS(null,"height",r),l.beforeDescription=l.element),!0}return!0}}),l.data.x=e.x??0,l.data.y=e.y??0,l.data.width=e.width??50,l.data.height=e.height??50,l.data.colorSetId=e.colorSetId,l.data.description=e.description}getData(){return this.data}addDragStartEventListener(e){this.draggable.addDragStartEventListener(e)}addDragEndEventListener(e){this.draggable.addDragEndEventListener(e)}addResizeStartEventListener(e){this.transformable.addResizeStartEventListener(e)}addResizeEndEventListener(e){this.transformable.addResizeEndEventListener(e)}show(){this.data.isShow=!0}hide(){this.data.isShow=!1}destroy(){this.draggable.destroy(),this.transformable.destroy(),void 0!==this.element.parentNode&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element),void 0!==this.rectElement.parentNode&&null!==this.rectElement.parentNode&&this.rectElement.parentNode.removeChild(this.rectElement),this.main.data.focusObject===this&&(this.main.data.focusObject=void 0),delete this.main.features[this.id]}toJson(){return{type:this.type,layerIndex:this.layerIndex,id:this.id,name:this.name,x:this.data.x,y:this.data.y,width:this.data.width,height:this.data.height,colorSetId:this.colorSetId,description:this.description,metaData:this.metaData}}}class s{constructor(e){const n=this;n.main=e.main,n.element=document.createElement("div"),n.element.classList.add("sb-image"),n.imageElement=document.createElement("img"),n.imageElement.classList.add("sb-image-img"),n.imageElement.addEventListener("load",function(e){n.imageElement.style.width=this.naturalWidth+"px",n.imageElement.style.height=this.naturalHeight+"px",n.element.style.width=this.naturalWidth+"px",n.element.style.height=this.naturalHeight+"px";for(const t of n.callbacks)t(this)}),n.callbacks=[],n.data=new Proxy(n,{set(e,t,n,a){return e[t]=n,!0}})}getData(){return this.data}load(e){this.element.append(this.imageElement),this.imageElement.src=e.imageUrl,void 0!==e.callback&&this.imageElement.addEventListener("load",e.callback)}unload(){void 0!==this.imageElement&&null!==this.imageElement&&(this.imageElement.src=null),void 0!==this.imageElement.parentNode&&null!==this.imageElement.parentNode&&this.imageElement.parentNode.removeChild(this.imageElement)}addImageLoadEventListener(e){this.callbacks.push(e)}}class l{constructor(e){const n=this;n.main=e.main,n.element=document.createElement("div"),n.element.classList.add("sb-video"),n.loadStartCallbacks=[],n.loadEndCallbacks=[],n.playCallbacks=[],n.frameCallbacks=[],n.pauseCallbacks=[],n.endedCallbacks=[],n.waitingCallbacks=[],n.frameInterval=void 0,n._currentFrame=void 0,n.maxFrame=void 0,n.currentTime=void 0,n.maxTime=void 0,n.fps=void 0,n.isPlay=!1,n.isLoading=!1,n.playMode=void 0,n.playFrameUpdate=function(e){const t=this;!0===t.isPlay&&setTimeout(function(){if(!t.updateCurrentFrame(1)){t.isPlay=!1;for(const e of t.endedCallbacks)e(void 0)}},1/t.fps*1e3)}.bind(n),n.videoElement=document.createElement("video"),n.videoElement.classList.add("sb-video-video"),n.videoElement.addEventListener("loadstart",function(){n.isLoading=!0;for(const e of n.loadStartCallbacks)e(this)}),n.videoElement.addEventListener("loadeddata",function(e){0===n.playMode&&n.updateCurrentTime(),n.videoElement.style.width=this.videoWidth+"px",n.videoElement.style.height=this.videoHeight+"px",n.element.style.width=this.videoWidth+"px",n.element.style.height=this.videoHeight+"px",n.isLoading=!1,n.maxTime=n.videoElement.duration,n.maxFrame=Math.floor(n.maxTime*n.fps),n.updateCurrentTime();for(const t of n.loadEndCallbacks)t(this)}),n.videoElement.addEventListener("play",function(e){0===n.playMode&&n.updateCurrentTime();for(const t of n.playCallbacks)t(e)}),n.videoElement.addEventListener("playing",function(e){}),n.videoElement.addEventListener("waiting",function(e){for(const t of n.waitingCallbacks)t(e)}),n.videoElement.addEventListener("pause",function(e){0===n.playMode&&n.updateCurrentTime(),clearInterval(n.frameInterval),n.frameInterval=void 0;for(const t of n.pauseCallbacks)t(e)}),n.videoElement.addEventListener("ended",function(e){0===n.playMode&&n.updateCurrentTime(),clearInterval(n.frameInterval),n.frameInterval=void 0,n.isPlay=!1;for(const t of n.endedCallbacks)t(e)}),n.videoElement.addEventListener("timeupdate",function(e){if(0===n.playMode){n.updateCurrentTime();for(const t of n.frameCallbacks)t(e)}}),n.data=new Proxy(n,{set(e,t,n,a){return e[t]=n,!0}})}getData(){return this.data}get currentFrame(){return this._currentFrame}set currentFrame(e){this._currentFrame=e,this.updateCurrentFrame()}load(e){this.fps=e.fps??30,this.element.append(this.videoElement),this.videoElement.src=e.videoUrl,void 0!==e.callback&&this.videoElement.addEventListener("loadeddata",e.callback)}unload(){(this.fps=void 0)!==this.frameInterval&&clearInterval(this.frameInterval),void 0!==this.videoElement&&null!==this.videoElement&&(this.videoElement.src=null),void 0!==this.videoElement.parentNode&&null!==this.videoElement.parentNode&&this.videoElement.parentNode.removeChild(this.videoElement)}play(e){!0!==this.isPlay&&(this.isPlay=!0,this.playMode=0,e=e??function(){},this.videoElement.play().then(e))}playFrame(){if(!0!==this.isPlay){var e=this;e.isPlay=!0,e.playMode=1;for(const t of e.playCallbacks)t(void 0);void 0===e._currentFrame&&(e._currentFrame=0),e.videoElement.addEventListener("timeupdate",e.playFrameUpdate),e.updateCurrentFrame(1)}}pause(){if(!1!==this.isPlay){var e=this;switch(e.isPlay=!1,e.playMode){case 0:e.videoElement.pause();break;case 1:e.videoElement.removeEventListener("timeupdate",e.playFrameUpdate);for(const t of e.pauseCallbacks)t(void 0)}}}moveFrame(e){void 0!==this.fps&&((e=null==e||e<0?0:e)>this.maxFrame&&(e=this.maxFrame),e=Number(e),this._currentFrame=e,this.currentTime=this._currentFrame/this.fps,this.updateCurrentFrame())}addVideoLoadStartEventListener(e){this.loadStartCallbacks.push(e)}addVideoLoadEndEventListener(e){this.loadEndCallbacks.push(e)}addVideoPlayEventListener(e){this.playCallbacks.push(e)}addVideoFrameEventListener(e){this.frameCallbacks.push(e)}addVideoPauseEventListener(e){this.pauseCallbacks.push(e)}addVideoEndedEventListener(e){this.endedCallbacks.push(e)}addVideoWaitingEventListener(e){this.waitingCallbacks.push(e)}updateCurrentTime(){void 0!==this.fps&&(this.currentTime=this.videoElement.currentTime,this._currentFrame=Math.floor(this.currentTime*this.fps))}updateCurrentFrame(e){if(void 0===this.fps)return!0;void 0===this.currentTime&&(this.currentTime=0),null==e&&(e=0),this.videoElement.currentTime=this._currentFrame/this.fps;for(const t of this.frameCallbacks)t(void 0);return this._currentFrame<this.maxFrame?(this._currentFrame=this._currentFrame+e,this._currentFrame>=this.maxFrame&&(this._currentFrame=this.maxFrame),this.currentTime=this.videoElement.currentTime,!0):(this.currentTime=this.maxTime,this._currentFrame=Math.floor(this.currentTime*this.fps),this._currentFrame>=this.maxFrame&&(this._currentFrame=this.maxFrame),!1)}}const g={has(e,t){let n=e.parentNode;for(;void 0!==n&&null!==n;){if(n===t)return!0;n=n.parentNode}return!1}};return class{constructor(e){const r=this;(r.main=r).type="Main",r.rootElementSelector=e.elementSelector,r.rootWidth="0px",r.rootHeight="0px",r.rootElement=document.querySelector(r.rootElementSelector),r.rootElement.classList.add("sb-root","sb-scrollbar"),r.backgroundImage=new s({main:r.main}),r.rootElement.append(r.backgroundImage.element),r.backgroundVideo=new l({main:r.main}),r.rootElement.append(r.backgroundVideo.element),r.element=document.createElementNS(b,"svg"),r.element.classList.add("sb-svg"),r.rootElement.append(r.element),r.backgroundLayerElement=document.createElementNS(b,"g"),r.backgroundLayerElement.classList.add("sb-layer-background"),r.element.append(r.backgroundLayerElement),r.layerElementSize=e.layerSize??1,r.layerElements=[];for(let e=0;e<r.layerElementSize;e++)r.addLayer();r.foregroundLayerElement=document.createElementNS(b,"g"),r.foregroundLayerElement.classList.add("sb-layer-foreground"),r.element.append(r.foregroundLayerElement);let n=void 0,a=void 0;r.draggable=new d({main:r,object:r,customMoveAt:function({x:e,y:t}){r.rootElement.scrollLeft=-1*e+n,r.rootElement.scrollTop=-1*t+a}}),r.draggable.addDragStartEventListener(function(e){n=r.rootElement.scrollLeft,a=r.rootElement.scrollTop}),r.draggable.addDragEndEventListener(function(e){n=void 0,a=void 0}),r.focusObjectChangeCallbacks=[],r.focusObject=void 0,r.x=0,r.y=0,r.width=0,r.height=0,r.data=new Proxy(r,{set(e,t,n,a){switch(e[t]=n,t){case"focusObject":for(const i of r.focusObjectChangeCallbacks)i(r.data.focusObject);return!0;case"rootWidth":return r.rootElement.style.width=n,!0;case"rootHeight":return r.rootElement.style.height=n,!0;case"width":return r.element.setAttributeNS(null,"viewBox",`0 0 ${r.data.width} `+r.data.height),r.element.setAttributeNS(null,"width",r.data.width),r.element.style.width=r.data.width+"px",!0;case"height":return r.element.setAttributeNS(null,"viewBox",`0 0 ${r.data.width} `+r.data.height),r.element.setAttributeNS(null,"height",r.data.height),r.element.style.height=r.data.height+"px",!0;case"x":return r.element.setAttributeNS(null,"x",n),!0;case"y":return r.element.setAttributeNS(null,"y",n),!0}return!0}}),r.data.rootWidth=e.width??"640px",r.data.rootHeight=e.height??"480px",r.data.width=0,r.data.height=0,r.data.x=0,r.data.y=0,r.features={},r.backgroundImage.addImageLoadEventListener(function(e){r.data.width=e.naturalWidth,r.data.height=e.naturalHeight}),r.backgroundVideo.addVideoLoadEndEventListener(function(e){r.data.width=e.videoWidth,r.data.height=e.videoHeight}),window.addEventListener("mousedown",function(e){0===e.button&&void 0!==r.data.focusObject&&g.has(e.target,r.element)&&(r.data.focusObject.data.focus=!1,r.data.focusObject=void 0)}),window.addEventListener("resize",function(e){r.onResize()}),r.onResize(),r.element.addEventListener("contextmenu",function(e){e.preventDefault()})}getData(){return this.data}getBackgroundImage(){return this.backgroundImage}getBackgroundVideo(){return this.backgroundVideo}addLayer(e){e=e??this.layerElements.length;const t=document.createElementNS(b,"g");t.classList.add("sb-layer"),t.classList.add("sb-layer-"+e),this.layerElements.push(t),this.element.append(t)}showLayer(e){this.layerElements[e].classList.remove("sb-layer-hide")}hideLayer(e){this.layerElements[e].classList.add("sb-layer-hide")}getFocusFeature(){return this.focusObject}setFocusFeature(e){this.features.hasOwnProperty(e)&&(e=this.features[e],void 0!==this.data.focusObject&&(this.data.focusObject.data.focus=!1),this.data.focusObject=e,this.data.focusObject.data.focus=!0)}loadImage(e){this.backgroundImage.load(e)}unloadImage(){this.backgroundImage.unload()}loadVideo(e){this.backgroundVideo.load(e)}unloadVideo(){this.backgroundVideo.unload()}addFeature(e){if(void 0===e.type)throw new Error("올바른 type 값을 지정해야 합니다.");switch(e.type){case"Skeleton":return this.addSkeletonFeature(e);case"Rect":return this.addRectFeature(e);default:throw new Error("올바른 type 값을 지정해야 합니다.")}}addSkeletonFeature(e){var t=e?.id??r.generateUUID();if(this.features.hasOwnProperty(t))throw new Error(`이미 존재하는 Feature ID입니다. [${t}]`);var n=e?.layerIndex??0,t=this.getCenterXY(),e=new u({main:this,id:e?.id??r.generateUUID(),name:e?.name,layerIndex:n,x:e?.x??t.x,y:e?.y??t.y,colorSetId:e.colorSetId,jointJsons:e.jointJsons,metaData:e.metaData});return console.log("skeleton",e),this.foregroundLayerElement.append(e.backgroundElement),this.layerElements[n].append(e.element),this.features[e.id]=e}addSkeletonFeatureByObject(e){return this.foregroundLayerElement.append(e.backgroundElement),this.layerElements[e.layerIndex].append(e.element),this.features[e.id]=e}addRectFeature(e){var t=e?.id??r.generateUUID();if(this.features.hasOwnProperty(t))throw new Error(`이미 존재하는 Feature ID입니다. [${t}]`);var n=e?.layerIndex??0,a=this.getCenterXY(),e=new h({main:this,id:t,name:e?.name,layerIndex:n,x:e?.x??a.x-25,y:e?.y??a.y-25,width:e?.width??50,height:e?.height??50,colorSetId:e.colorSetId,description:e.description,metaData:e.metaData});return this.layerElements[n].append(e.element),this.features[e.id]=e}addRectFeatureByObject(e){return this.layerElements[e.layerIndex].append(e.element),this.features[e.id]=e}removeFeature(e){if(!(e in this.features))throw new Error("해당하는 스켈레톤 ID가 없습니다.");this.features[e].destroy()}clearFeatures(){for(const e of Object.values(this.features))void 0!==e.destroy&&null!==e.destroy&&e.destroy(),delete this.features[e];this.data.focusObject=void 0}getSize(){return{width:this.data.width,height:this.data.height}}setSize(e){this.data.width=e.width,this.data.height=e.height}addFocusObjectChangeEventListener(e){this.focusObjectChangeCallbacks.push(e)}onResize(){var{width:e,height:t}=this.element.getBoundingClientRect();this.rootWidth=e,this.rootHeight=t,this.data.width=e,this.data.height=t}getCenterXY(){var e=this.element.getAttributeNS(null,"width"),t=this.element.getAttributeNS(null,"height");return{x:Math.round(Number(e)/2),y:Math.round(Number(t)/2)}}fromJson(e){if("Main"!==e.type)throw new Error("올바른 Json 유형이 아닙니다.");var t=this;for(const s of Object.values(t.features))s.destroy();var n=e.featureJsons.map(e=>e.layerIndex),a=m.maxByArray(n);for(let e=t.layerElements.length;e<=a;e++)t.addLayer();t.layerElementSize=t.layerElements.length;for(const o of e.featureJsons)switch(o.type){case"Skeleton":{var i=o;const d=[];for(const l of i.jointJsons){var r=new c({main:t.main,id:l.id,name:l.name,x:l.x,y:l.y,r:l.r,metaData:l.metaData});d.push(r)}i=new u({main:t.main,id:i.id,name:i.name,layerIndex:i.layerIndex,x:i.x,y:i.y,joints:d,colorSetId:i.colorSetId,metaData:i.metaData});t.addSkeletonFeatureByObject(i);break}case"Rect":i=o,i=new h({main:t.main,id:i.id,name:i.name,layerIndex:i.layerIndex,x:i.x,y:i.y,width:i.width,height:i.height,colorSetId:i.colorSetId,metaData:i.metaData});t.addRectFeatureByObject(i)}}toJson(){const e=[];for(const t of Object.values(this.features))e.push(t.toJson());return{type:this.type,layerSize:this.layerElements.length,featureJsons:e}}}});
